<!DOCTYPE html>
<html lang="he" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>拽注转 转专</title>
    <link rel="stylesheet" href="/static/style.css" />
  </head>

  <body>
    <header>
      <div class="header-content">
        <h1 class="logo">住驻专转 专专 砖驻 </h1>
        <a class="btn-admin" href="/admin/login"> 住转 </a>
      </div>
    </header>

    <div class="form-container">
      <h2>拽注转 转专</h2>

      <form class="appointment-form">
        <label>砖 :</label>
        <input type="text" name="name" required />

        <label>驻:</label>
        <input type="text" name="phone" required />
        <label>:</label>
        <input type="email" name="email" required />
        <label>住 驻:</label>
        <select name="service" required>
          <option value="转住驻专转 专">转住驻专转 专</option>
        </select>

        <label>转专:</label>
        <input
          type="date"
          name="date"
          min="{{ today }}"
          value="{{ today }}"
          required
          oninput="loadSlots(this.value)"
        />

        <label>专 砖注:</label>
        <div id="slots" class="time-grid"></div>

        <button class="btn-approve" type="submit">拽注 转专</button>
      </form>
    </div>

    <script>
      async function loadSlots(selectedDate) {
        if (!selectedDate) return;

        const d = new Date(selectedDate);
        if (d.getDay() === 6) {
          alert(" 注 砖转!");
          document.querySelector("input[name='date']").value = "";
          document.getElementById("slots").innerHTML = "";
          return;
        }

        const res = await fetch(`/api/free-slots?date=${selectedDate}`);
        const data = await res.json();

        let html = "";
        data.slots.forEach((s) => {
          html += `
        <label class="time-slot">
            <input type="radio" name="hour" value="${s}" required>
            <span>${s}</span>
        </label>`;
        });

        if (data.slots.length === 0) {
          html = "<div> 砖注转 驻转  </div>";
        }

        document.getElementById("slots").innerHTML = html;
      }

      // 砖转 驻住
      document.querySelector(".appointment-form").onsubmit = async function (
        e
      ) {
        e.preventDefault();

        const form = new FormData(this);

        const res = await fetch("/book", {
          method: "POST",
          body: form,
        });

        const data = await res.json();
        if (data.status === "success") {
          alert(
            "拽砖 转专 拽 转 砖专 . 转拽 注  专 砖专."
          );

          setTimeout(() => {
            window.location.reload();
          }, 800);
        } else {
          alert(data.msg);
        }
      };
    </script>
  </body>
</html>
